Negotiation Environment Generation
===
([API](http://fehu.github.io/agent-negotiation/unidoc/index.html#feh.tec.agents.lite.spec.macros.package))

Controller, negotiating and system agents are all generated by a set of macro, defined at  [ControllerMacro](src/main/scala/feh/tec/agents/lite/spec/macros/impl/ControllerMacro.scala).

The macros work by applying transformations, called `MacroSegment`, to [abstract syntax trees (AST)](http://docs.scala-lang.org/overviews/reflection/symbols-trees-types.html) in 
[ControllerBuildingMacroEnvironment#Trees](src/main/scala/feh/tec/agents/lite/spec/macros/ControllerBuildingMacroEnvironment.scala)
and [ActorBuildingMacro#ActorTrees](src/main/scala/feh/tec/agents/lite/spec/macros/ActorBuildingMacro.scala)
containers.

Many of the segments use 
[NegotiationBuildingMacro#NegotiationRaw](src/main/scala/feh/tec/agents/lite/spec/macros/NegotiationBuildingMacro.scala)(*Negotiation Raw Definition*),
that contains the definitions from the processed [Negotiation](src/main/scala/feh/tec/agents/lite/spec/dsl/Negotiation.scala). 

![Negotiation Steps Decomposition](https://docs.google.com/uc?authuser=0&id=0B9XpukXOfywNSDdSekVrVzhIUHc)

A [ControllerBuildingMacroEnvironment#MacroSegments](src/main/scala/feh/tec/agents/lite/spec/macros/ControllerBuildingMacroEnvironment.scala)
groups `MacroSegment`s by stages and defines `stagesOrdering: Ordering[Stage]` used to determine stages order when chaining the fragments into a single one.

![Macro Stages](https://docs.google.com/uc?authuser=0&id=0B9XpukXOfywNNjhjYlNmNWRadFk)

