QueenNegotiationApp
==

The negotiation application is defined by the following *negotiation specifcation* 
([source](src/main/scala/feh/tec/agents/lite/QueenNegotiationApp.scala)) and 
[QueenSpec](QueenSpec.md) *agent specification*, which defines the agent's behaviour.


```scala
import feh.tec.agents.lite.spec.dsl._

implicit val asys: ActorSystem

def WebPushServer: ActorRef

def shutDownIn: FiniteDuration

def negController(boardSize: Int) = controller {
    new Negotiation {

      var x = variable `with` domain(1 to boardSize)
      var y = variable `with` domain(1 to boardSize)

      def `queen's position` = negotiation over(x, y)

      def Queen = agent withRole "chess queen" definedBy QueenSpec() that (
        negotiates the `queen's position` `with` the.others reportingTo 
          reporter.forwarding(WebPushServer) and
          hasConstraints(
            "direct-line sight" | {
              /* Constraints that can be run independently for different vars 
                  should be separated by && or ||, or defined separately */
              proposed(x) != valueOf(x) && proposed(y) != valueOf(y)
            },
            "diagonal-line sight" | {
              (proposed(x) - valueOf(x)).abs != (proposed(y) - valueOf(y)).abs
            }
          )
        )

      spawn agents (
        Queen -> boardSize
        )

      configure(
        timeout.initialize <= 100.millis,
        timeout.start <= 200.millis,
        timeout.`response delay` <= 20.millis
      )

      when finished {
        controller =>
          (neg, values) => {
            controller.log.info(
              s"negotiation $neg successfully finished: ${values.toList}};" +
              s"\nShutting Down in $shutDownIn"
              )
            controller.agents.foreach{
              ag =>
                ag.ref.tell(
                  AgentReport.StateRequest(neg),
                  WebPushServer
                )
            }
            asys.scheduler.scheduleOnce(shutDownIn, () => {
              WebPushServer.tell(SystemMessage.NegotiationFinished(neg, values), controller.self)
              asys.shutdown()
              asys.awaitTermination()
              sys.exit(0)
            })(asys.dispatcher)
          }
      }

      when failed {
        controller =>
          (neg, reason) => {
            controller.log.error(s"negotiation $neg failed: $reason")
            asys.shutdown()
            sys.exit(1)
          }

      }
    }
  }

```

### Examples
Video: 
[6 Queens](https://docs.google.com/uc?authuser=0&id=0B9XpukXOfywNRzRCWmFMVHU5TDg) | 
[8 Queens](https://docs.google.com/uc?authuser=0&id=0B9XpukXOfywNUVc2d0Fzb2VvT0k) | 
[10 Queens](https://docs.google.com/uc?authuser=0&id=0B9XpukXOfywNVlBpc000OXRZNlE) | 
[12 Queens](https://docs.google.com/uc?authuser=0&id=0B9XpukXOfywNbXBqSk5ILXdYcm8)

### Code, Generated my Macros

#### TODO
- [ ] constraints checking functions should be generated by the macros entirely

```scala

((createPropsArgs: Map[String, Any]) => {
  class $AnonNegotiationController extends NegotiationEnvironmentController() with feh.tec.agents.lite.impl.service.ReportPrinterSupportBundle {
    def <init>() = {
      super.<init>();
      ()
    };
    def configInfo = feh.tec.agents.lite.impl.service.SupportBundle.Config({
      import feh.util.Path._;
      $u002E.$div("agents").$div("controller.conf")
    });
    protected object InitialPriority extends scala.AnyRef {
      def <init>() = {
        super.<init>();
        ()
      };
      private var p = Map.empty[NegotiationId, Priority];
      def next(neg: NegotiationId) = synchronized({
        val pr = p.getOrElse(neg, new Priority(0)).raise();
        p.$plus$eq(neg.$minus$greater(pr));
        pr
      })
    };
    protected val issues: Map[String, Var] = Map("x".$minus$greater({
      final class $anon extends Var("x", ((x$5) => x$5.isInstanceOf[Int])) with Domain.Range {
        def <init>() = {
          super.<init>();
          ()
        };
        def domain: Range = scala.this.Predef.intWrapper(1).to(boardSize)
      };
      new $anon()
    }), "y".$minus$greater({
      final class $anon extends Var("y", ((x$6) => x$6.isInstanceOf[Int])) with Domain.Range {
        def <init>() = {
          super.<init>();
          ()
        };
        def domain: Range = scala.this.Predef.intWrapper(1).to(boardSize)
      };
      new $anon()
    }));
    protected val issuesByNegotiation: Map[String, Seq[String]] = Map("queen\'s position".$minus$greater(Seq("x", "y")));
    protected val domainIteratorsCreators: Map[String, DomainIteratorBuilder[Var#Domain, Var#Tpe]] = Map("x".$minus$greater(new DomainIteratorBuilder.Range().asInstanceOf[DomainIteratorBuilder[Var#Domain, Var#Tpe]]), "y".$minus$greater(new DomainIteratorBuilder.Range().asInstanceOf[DomainIteratorBuilder[Var#Domain, Var#Tpe]]));
    import feh.tec.agents.lite.spec.NegotiationSpecification._;
    protected val initialAgents: List[scala.Tuple2[AgentDef, _root_.scala.Function1[CreateInterface, AgentRef]]] = List(feh.tec.agents.lite.spec.NegotiationSpecification.AgentDef("Queen", "chess queen", Seq(feh.tec.agents.lite.spec.NegotiationSpecification.AgentNegDef("queen\'s position", InterlocutorsByRoles(scala.collection.immutable.Set("chess queen")), Seq(AgentConstraintsDef(Seq(AgentConstraintDef("direct-line sight", ConstraintPartComb("and", ConstraintPartLeaf(AgentVarConstraintDef(Seq(ConstraintParamDescription("proposed", "x", "$_proposal_x"), ConstraintParamDescription("valueOf", "x", "$_value_x")), (($_proposal_x: Int, $_value_x: Int) => $_proposal_x.$bang$eq($_value_x)).tupled.asInstanceOf[_root_.scala.Function1[Product, Boolean]])), ConstraintPartLeaf(AgentVarConstraintDef(Seq(ConstraintParamDescription("proposed", "y", "$_proposal_y"), ConstraintParamDescription("valueOf", "y", "$_value_y")), (($_proposal_y: Int, $_value_y: Int) => $_proposal_y.$bang$eq($_value_y)).tupled.asInstanceOf[_root_.scala.Function1[Product, Boolean]])))), AgentConstraintDef("diagonal-line sight", ConstraintPartLeaf(AgentVarConstraintDef(Seq(ConstraintParamDescription("proposed", "x", "$_proposal_x"), ConstraintParamDescription("valueOf", "x", "$_value_x"), ConstraintParamDescription("proposed", "y", "$_proposal_y"), ConstraintParamDescription("valueOf", "y", "$_value_y")), (($_proposal_x: Int, $_value_x: Int, $_proposal_y: Int, $_value_y: Int) => scala.this.Predef.intWrapper($_proposal_x.$minus($_value_x)).abs.$bang$eq(scala.this.Predef.intWrapper($_proposal_y.$minus($_value_y)).abs)).tupled.asInstanceOf[_root_.scala.Function1[Product, Boolean]])))))))), QueenSpec.apply()).$minus$greater(((propsArgs: Map[String, Any]) => {
      val name = propsArgs("uniqueName").asInstanceOf[String];
      val props = ((createPropsArgs: Map[String, Any]) => {
        class $AgentAnonClass extends PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang](uniqueName, role, negotiationsInit, args) with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.RequiresDistinctPriority with feh.tec.agents.lite.impl.agent.FailureChecks[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.ChangingIssuesImpl[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.PartialSolutionsChecks[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.AutoReporting[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.SortResending[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.NegotiationNotifications {
          <paramaccessor> private[this] val uniqueName: String = _;
          <paramaccessor> private[this] val role: feh.tec.agents.lite.NegotiationRole = _;
          <paramaccessor> private[this] val negotiationsInit: Set[feh.tec.agents.lite.AgentCreationInterface.NegotiationInit] = _;
          <paramaccessor> private[this] val args: scala.collection.immutable.Map[String,Any] = _;
          def <init>(uniqueName: String, role: feh.tec.agents.lite.NegotiationRole, negotiationsInit: Set[feh.tec.agents.lite.AgentCreationInterface.NegotiationInit], args: scala.collection.immutable.Map[String,Any]) = {
            super.<init>();
            ()
          };
          type Negotiation = feh.tec.agents.lite.Negotiation.DynamicScope with feh.tec.agents.lite.Negotiation.HasPriority with feh.tec.agents.lite.Negotiation.HasProposal[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.Negotiation.ChangingIssues with feh.tec.agents.lite.Negotiation.HasIterators with feh.tec.agents.lite.Negotiation.ChangeHooks;
          type Agent = feh.tec.agents.lite.impl.agent.PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.ChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang];
          type $AgentAnonClassLang = feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang;
          lazy val initialPriority = args("initial-priority").asInstanceOf[Map[NegotiationId, Priority]];
          val reportingTo: Map[NegotiationId, AgentRef] = Map(NegotiationId("queen\'s position").$minus$greater(args("report-to").asInstanceOf[AgentRef]));
          def extraMessage: Map[String, Any] = Map();
          def stateReport(negId: NegotiationId) = feh.tec.agents.lite.StateReport(negId, get(negId).report(), "by demand");
          protected def controllerRef = args("controller-ref").asInstanceOf[AgentRef];
          protected def createNegotiation(nId: NegotiationId): Negotiation = {
            val neg = {
              final class $anon extends feh.tec.agents.lite.Negotiation.DynamicScope with feh.tec.agents.lite.Negotiation.HasPriority with feh.tec.agents.lite.Negotiation.HasProposal[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.Negotiation.ChangingIssues with feh.tec.agents.lite.Negotiation.HasIterators with feh.tec.agents.lite.Negotiation.ChangeHooks {
                def <init>() = {
                  super.<init>();
                  ()
                };
                val id = nId;
                val issues: Set[Var] = negotiationsInit.find(((x$2) => x$2.id.$eq$eq(id))).getOrElse(sys.error("createNegotiation: no id found")).issues;
                def scopeUpdated(): Unit = ()
              };
              new $anon()
            };
            negotiationCreated(neg);
            neg
          };
          def domainIterators = args("domain-iterators").asInstanceOf[Map[Var, DomainIteratorBuilder[Var#Domain, Var#Tpe]]];
          val constraintsByNegotiation = args("constraints-by-negotiation").asInstanceOf[Map[feh.tec.agents.lite.NegotiationId,feh.tec.agents.lite.spec.NegotiationSpecification.AgentConstraintsDef]];
          protected def seqToTuple(seq: Seq[Any]): Product = ((s: Seq[Any]) => s match {
            case (seq @ _) if seq.length.$eq$eq(2) => Tuple2(seq(0), seq(1))
            case (seq @ _) if seq.length.$eq$eq(3) => Tuple3(seq(0), seq(1), seq(2))
            case (seq @ _) if seq.length.$eq$eq(4) => Tuple4(seq(0), seq(1), seq(2), seq(3))
            case (seq @ _) if seq.length.$eq$eq(5) => Tuple5(seq(0), seq(1), seq(2), seq(3), seq(4))
            case (seq @ _) if seq.length.$eq$eq(6) => Tuple6(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5))
            case (seq @ _) if seq.length.$eq$eq(7) => Tuple7(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6))
            case (seq @ _) if seq.length.$eq$eq(8) => Tuple8(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7))
            case (seq @ _) if seq.length.$eq$eq(9) => Tuple9(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8))
            case (seq @ _) if seq.length.$eq$eq(10) => Tuple10(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9))
            case (seq @ _) if seq.length.$eq$eq(11) => Tuple11(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10))
            case (seq @ _) if seq.length.$eq$eq(12) => Tuple12(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11))
            case (seq @ _) if seq.length.$eq$eq(13) => Tuple13(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12))
            case (seq @ _) if seq.length.$eq$eq(14) => Tuple14(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13))
            case (seq @ _) if seq.length.$eq$eq(15) => Tuple15(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14))
            case (seq @ _) if seq.length.$eq$eq(16) => Tuple16(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14), seq(15))
            case (seq @ _) if seq.length.$eq$eq(17) => Tuple17(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14), seq(15), seq(16))
            case (seq @ _) if seq.length.$eq$eq(18) => Tuple18(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14), seq(15), seq(16), seq(17))
            case (seq @ _) if seq.length.$eq$eq(19) => Tuple19(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14), seq(15), seq(16), seq(17), seq(18))
            case (seq @ _) if seq.length.$eq$eq(20) => Tuple20(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14), seq(15), seq(16), seq(17), seq(18), seq(19))
            case (seq @ _) if seq.length.$eq$eq(21) => Tuple21(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14), seq(15), seq(16), seq(17), seq(18), seq(19), seq(20))
            case (seq @ _) if seq.length.$eq$eq(22) => Tuple22(seq(0), seq(1), seq(2), seq(3), seq(4), seq(5), seq(6), seq(7), seq(8), seq(9), seq(10), seq(11), seq(12), seq(13), seq(14), seq(15), seq(16), seq(17), seq(18), seq(19), seq(20), seq(21))
          })(seq);
          val spec = QueenSpec.apply().asInstanceOf[feh.tec.agents.lite.spec.AgentSpecification.PriorityAndProposalBased[feh.tec.agents.lite.impl.agent.PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.ChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang],feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.spec.AgentSpecification.PriorityAndProposalBased[feh.tec.agents.lite.impl.agent.PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.ChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang],feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.spec.AgentSpecification.Iterating[feh.tec.agents.lite.impl.agent.PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.ChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang],feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.spec.AgentSpecification.PriorityAndProposalBased[feh.tec.agents.lite.impl.agent.PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.ChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang],feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.spec.AgentSpecification.PriorityAndProposalBased[feh.tec.agents.lite.impl.agent.PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.ChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang],feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.spec.ChangingIssuesSpec[feh.tec.agents.lite.impl.agent.PriorityAndProposalBasedAgent[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.impl.agent.DomainIteratingChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang] with feh.tec.agents.lite.ChangingIssues[feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang],feh.tec.agents.lite.Language.ProposalBased with feh.tec.agents.lite.Language.HasPriority with feh.tec.agents.lite.Language.NegotiatesIssues with feh.tec.agents.lite.NegotiationLanguage with feh.tec.agents.lite.QueenSpec.Lang]];
          lazy val responseDelay = args("response-delay").asInstanceOf[scala.concurrent.duration.FiniteDuration]
        };
        akka.actor.Props(new $AgentAnonClass(uniqueName = createPropsArgs("uniqueName").asInstanceOf[String], role = createPropsArgs("role").asInstanceOf[feh.tec.agents.lite.NegotiationRole], negotiationsInit = createPropsArgs("negotiationsInit").asInstanceOf[Set[feh.tec.agents.lite.AgentCreationInterface.NegotiationInit]], args = createPropsArgs("args").asInstanceOf[scala.collection.immutable.Map[String,Any]]))
      })(propsArgs);
      val actorRef = implicitly[ActorSystem].actorOf(props, name);
      AgentRef(Agent.Id(name, propsArgs("role").asInstanceOf[Role]), actorRef)
    })));
    protected val systemAgentsInit: Set[_root_.scala.Function0[AgentRef]] = Set({
      val args = extraArgs("report-listener");
      def props = ((createPropsArgs: Map[String, Any]) => {
        class $ReportListener extends DefaultReportWriter(writeTo) {
          <paramaccessor> private[this] val writeTo: java.io.File = _;
          <paramaccessor> private[this] val controller: akka.actor.ActorRef = _;
          <paramaccessor> private[this] val confirmAllWaitingDelay: scala.concurrent.duration.FiniteDuration = _;
          def <init>(writeTo: java.io.File, controller: akka.actor.ActorRef, confirmAllWaitingDelay: scala.concurrent.duration.FiniteDuration) = {
            super.<init>();
            ()
          };
          type $ReportListenerLang = {};
          impl.agent.reporter.forwarding(QueenNegotiationApp.this.WebPushServer).forward.foreach(((f) => self.$bang(feh.tec.agents.lite.AgentReport.Forward(f))))
        };
        akka.actor.Props(new $ReportListener(writeTo = createPropsArgs("writeTo").asInstanceOf[java.io.File], controller = createPropsArgs("controller").asInstanceOf[akka.actor.ActorRef], confirmAllWaitingDelay = createPropsArgs("confirmAllWaitingDelay").asInstanceOf[scala.concurrent.duration.FiniteDuration]))
      })(args);
      def role = args("role").asInstanceOf[Role];
      def ref = implicitly[ActorSystem].actorOf(props, "report-listener");
      (() => AgentRef(Agent.Id("report-listener", role), ref))
    });
    lazy private val liftedArgsByNameAndAg: Map[String, Map[String, _root_.scala.Function0[Any]]] = Map("Queen".$minus$greater(scala.collection.immutable.Map(scala.Tuple2("constraints-by-negotiation", (() => {
      import feh.tec.agents.lite.spec.NegotiationSpecification;
      initialAgents.find(((x$4) => x$4._1.name.$eq$eq("Queen"))).getOrElse(sys.error("getConstraintsByNegotiation: no initialAgent ".$plus("Queen").$plus(" found")))._1.negotiations.map(<empty> match {
  case NegotiationSpecification.AgentNegDef((negName @ _), _, (extra @ _)) => {
    val constraints = extra.collect(<empty> match {
      case (c @ (_: NegotiationSpecification.AgentConstraintsDef)) => c
    });
    NegotiationId(negName).$minus$greater(constraints.ensuring(((x$3) => x$3.size.$eq$eq(1)), constraints.size.$plus(" AgentConstraintsDef defined")).head)
  }
}).toMap
    })), scala.Tuple2("initial-priority", (() => Map(NegotiationId("queen\'s position").$minus$greater(InitialPriority.next(NegotiationId("queen\'s position")))))), scala.Tuple2("domain-iterators", (() => issues.values.map(((v) => v.$minus$greater(domainIteratorsCreators(v.name)))).toMap)), scala.Tuple2("controller-ref", (() => this.ref)), scala.Tuple2("response-delay", (() => timeouts.response$u0020delay)), scala.Tuple2("report-to", (() => systemAgents.find(((x$1) => x$1.id.role.$eq$eq(feh.tec.agents.lite.impl.service.DefaultReportWriter.Role))).getOrElse(sys.error("no system agent for with ".$plus(feh.tec.agents.lite.impl.service.DefaultReportWriter.Role).$plus(" found"))))))), "report-listener".$minus$greater(scala.collection.immutable.Map(scala.Tuple2("writeTo", (() => reportFile)), scala.Tuple2("role", (() => feh.tec.agents.lite.impl.service.DefaultReportWriter.Role)), scala.Tuple2("controller", (() => self)), scala.Tuple2("confirmAllWaitingDelay", (() => timeouts.confirm$u0020finished)))));
    protected def extraArgs(agent: String): Map[String, Any] = liftedArgsByNameAndAg(agent).map(<empty> match {
      case scala.Tuple2((n @ _), (f @ _)) => n.$minus$greater(f())
    });
    protected val spawns: Map[String, Int] = Map("Queen".$minus$greater(boardSize));
    import feh.tec.agents.lite.impl.NegotiationEnvironmentController._;
    lazy protected val timeouts: Timeouts = {
      final class $anon extends Timeouts {
        def <init>() = {
          super.<init>();
          ()
        };
        lazy val initialize = akka.util.Timeout(scala.concurrent.duration.`package`.DurationInt(100).millis);
        lazy val start = akka.util.Timeout(scala.concurrent.duration.`package`.DurationInt(200).millis);
        lazy val stop = DefaultTimeouts.stop;
        lazy val reset = DefaultTimeouts.reset;
        lazy val response$u0020delay = scala.concurrent.duration.`package`.DurationInt(20).millis;
        lazy val confirm$u0020finished = DefaultTimeouts.confirm$u0020finished
      };
      new $anon()
    };
    def negotiationFinished(neg: NegotiationId, values: Seq[Map[Var, Any]]): Unit = (($arg_controller: feh.tec.agents.lite.impl.NegotiationEnvironmentController) => (($arg_name: NegotiationId, $arg_values: Seq[Map[Var, Any]]) => {
      $arg_controller.log.info(scala.StringContext.apply("negotiation ", " successfully finished: ", "};\\nShutting Down in ", "").s($arg_name, $arg_values.toList, shutDownIn));
      $arg_controller.agents.foreach[Unit](((ag: feh.tec.agents.lite.AgentRef) => ag.ref.tell(AgentReport.StateRequest.apply($arg_name), WebPushServer)));
      asys.scheduler.scheduleOnce(shutDownIn, feh.util.`package`.toRunnableWrapper((() => {
        WebPushServer.tell(SystemMessage.NegotiationFinished.apply($arg_name, $arg_values), $arg_controller.self);
        asys.shutdown();
        asys.awaitTermination();
        scala.sys.`package`.exit(0)
      })))(asys.dispatcher)
    }))(implicitly[feh.tec.agents.lite.impl.NegotiationEnvironmentController])(neg, values);
    def negotiationFailed(neg: NegotiationId, reason: String): Unit = (($arg_controller: feh.tec.agents.lite.impl.NegotiationEnvironmentController) => (($arg_name: NegotiationId, $arg_reason: String) => {
      $arg_controller.log.error(scala.StringContext.apply("negotiation ", " failed: ", "").s($arg_name, $arg_reason));
      asys.shutdown();
      scala.sys.`package`.exit(1)
    }))(implicitly[feh.tec.agents.lite.impl.NegotiationEnvironmentController])(neg, reason)
  };
  akka.actor.Props(new $AnonNegotiationController())
}).apply(Predef.Map.apply())

```
